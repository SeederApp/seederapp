<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN">
<div data-bb-type="screen" style="background-image:url('images/background.png'); background-color: #181818" data-bb-effect="slide-left" data-bb-scroll-effect="off"> 
<script type="text/javascript">
	bb.init({ondomready : function(element, id, params){
				loadIdeas();
				//alert(localStorage.getItem("userHash") + " | " + localStorage.getItem("userEmail"));
				//alert(params.userEmail + " | " + params.userHash);
		}
	});

	function onBackgroundCallback() {
		alert("Going to the background!");
	}
	
	function onBackground() {
		blackberry.app.event.onBackground(onBackgroundCallback);
	}
	
	//onBackground();

	function sendRequest(url, callback) {
		var xmlhttp;
		if (window.XMLHttpRequest){
			xmlhttp=new XMLHttpRequest();
		}
		xmlhttp.onreadystatechange = function(){
			if (xmlhttp.readyState==4 && xmlhttp.status==200){
					if (xmlhttp.responseText == "" || JSON.parse(xmlhttp.responseText) == "") {
						/*document.getElementById('message').innerHTML = "Failure to load ideas. Please check your Internet connection.";
						document.getElementById('indicator').style.visibility="hidden";
						document.getElementById('indicator').style.display="none";*/
					} else {
						callback(JSON.parse(xmlhttp.responseText));
					}
			}
		}
		xmlhttp.open("GET",url,true);
		xmlhttp.send();
	}
	
	function help() {
		bb.pushScreen('help.html', 'help');
	}
	
	function settings() {
		bb.pushScreen('settings.html', 'settings');
	}
	
	function seeDetails(idIdea){
		console.log(idIdea);
	}

	function allIdeas() {
		categoryType = 'All';
		refreshIdeas();
	}
	
	function appIdeas() {
		categoryType = 'Apps';
		refreshIdeas();
	}

	function gameIdeas() {
		categoryType = 'Games';
		refreshIdeas();
	}

	function popularIdeas() {
		filter = 'votes';
		refreshIdeas();
	}
	
	function recentIdeas() {
		filter = 'date';
		refreshIdeas();
	}
	function newIdea() {
		bb.pushScreen('newIdea.html', 'newIdea');
	}
	
	var filter = 'votes';
	var categoryType = 'All';
	var url = "http://seederserver.aws.af.cm/index.php?ideas&command=getAllIdeasByFilter&values[]=votes&values[]=DESC";
	
	function refreshIdeas() {
		
		if (categoryType == 'All'){
			url = "http://seederserver.aws.af.cm/index.php?ideas&command=getAllIdeasByFilter&values[]=" + filter + "&values[]=DESC";
		} else {
			url = "http://seederserver.aws.af.cm/index.php?ideas&command=getAllIdeasByCategoryType&values[]=" + categoryType + "&values[]=" + filter + "&values[]=DESC";
		}		
		var allIdeas = document.getElementById("allIdeasList");
		allIdeas.innerHTML = "";
		loadIdeas();
	}
	function getDetails (id) {
		console.log(id);
	}
	
	function loadIdeas() {
		//Default ideas loading options
		document.getElementById('indicator').style.display="block";
		sendRequest(url, function (data){
			var ideas = data[0][0][0];
			var listItem, dataList = document.getElementById('allIdeasList');
			for (var i = 0; i < data.length; i++) {
				//Ideas reported very often are hidden
				if ((data[i][0]['reportNumber']) < 10){
					listItem = document.createElement('div');
					listItem.setAttribute("onclick", "getDetails("+data[i][0]['idIdea']+")");
					listItem.setAttribute('data-bb-type', 'item');
					listItem.setAttribute('onbtnclick', 'seeDetails(' + data[i][0]['idIdea'] + ');');
					listItem.setAttribute('data-bb-img', 'images/categories/category-'+data[i][0]['idCategory']+'.png');
					listItem.setAttribute('data-bb-title', data[i][0]['title']);
					listItem.setAttribute('data-bb-accent-text', data[i][0]['votes']);
					listItem.innerHTML = data[i][0]['description'];
					document.getElementById("allIdeasList").appendItem(listItem);
				}
			}
			document.getElementById('indicator').style.display="none";
		});
	}
	/*window.onload = loadIdeas();*/
</script>
	<div data-bb-type="title" data-bb-caption="Discover new ideas"></div>	
	
	<!-- App menu -->
	<div data-bb-type="menu">
		<div onClick="help();" data-bb-type="menu-item" data-bb-img="images/icons/help.png" data-bb-pin="left">Help</div>
		<div onClick="coins();" data-bb-type="menu-item" data-bb-img="images/icons/coin-2.png" data-bb-pin="center">Coins</div>
		<div onClick="settings();" data-bb-type="menu-item" data-bb-img="images/icons/settings.png" data-bb-pin="right">Settings</div>
	</div>
	
	<!-- Action bar -->
	<div data-bb-type="action-bar"> 
		
		<!-- Tabs -->
		<div onClick="allIdeas();" data-bb-type="action" data-bb-overflow="true" data-bb-style="tab" data-bb-img="images/icons/all.png" data-bb-selected="true">All</div>
		<div onClick="appIdeas();" data-bb-type="action" data-bb-style="tab" data-bb-overflow="true" data-bb-img="images/icons/apps.png">Apps</div>
		<div onClick="gameIdeas();" data-bb-type="action" data-bb-style="tab" data-bb-overflow="true" data-bb-img="images/icons/games.png">Games</div>
		
		<!-- Actions -->
		<div onClick="refreshIdeas()" data-bb-type="action" data-bb-style="button" data-bb-img="images/icons/refresh.png">Refresh</div>
		<!--<div onclick="" data-bb-type="action" data-bb-style="button" data-bb-img="images/icons/search.png">Search</div>-->
		
		<!-- Action overflow -->
		<div onClick="popularIdeas();" data-bb-type="action" data-bb-style="button" data-bb-overflow="true" data-bb-img="images/icons/popular.png">Popular Ideas</div>
		<div onClick="recentIdeas();" data-bb-type="action" data-bb-style="button" data-bb-overflow="true" data-bb-img="images/icons/recent.png">Recent Ideas</div>
		<div onClick="newIdea()" data-bb-type="action" data-bb-style="button" data-bb-overflow="true" data-bb-img="images/icons/submit.png">Submit New Idea</div>
	</div>
	
	<!-- Content -->
	<div id="content">
		<div id="indicator" data-bb-type="activity-indicator" data-bb-size="medium" style="margin: 0 auto; margin-top: 50%; display:none"></div>
		<div id="allIdeasList" data-bb-type="image-list" data-bb-image-loading="images/icons/refresh.png"></div>
	</div>
</div>