<!DOCTYPE html>
<div data-bb-type="screen" style="background-image:url('images/background.png'); background-color: #181818" data-bb-effect="fade" data-bb-scroll-effect="off">
	<script src="js/sha1.js"></script>
	<script type="text/javascript">
	function sendRequest(url, callback) {
		var xmlhttp;
		if (window.XMLHttpRequest)
		{
		  xmlhttp=new XMLHttpRequest();
		}
		xmlhttp.onreadystatechange=function(){
		  if (xmlhttp.readyState==4 && xmlhttp.status==200)
			{
				if (xmlhttp.responseText == "" || JSON.parse(xmlhttp.responseText) == "") {
					document.getElementById("message").innerHTML = "Incorrect email or password";
					document.getElementById('indicator').style.visibility="hidden";
					document.getElementById('indicator').style.display="none";
				}
				else{
					callback(JSON.parse(xmlhttp.responseText));}
			}
		}
		xmlhttp.open("GET",url,true);
		xmlhttp.send();
	}
	function registerUser() {
		bb.pushScreen('register.html', 'registerUser');
	}
	function authenticateUser () {
		document.getElementById('indicator').style.visibility="visible";
		document.getElementById('indicator').style.display="block";
		document.getElementById("message").innerHTML = "";
		var password = document.getElementById("password").value;
		var email = document.getElementById("email").value;
		sendRequest("http://seederserver.aws.af.cm/index.php?users&command=getSaltByEmail&values[]=" +email, function (data){
			var salt = data[0][0][0];
			var hash = Sha1.hash(password + salt);
			url = "http://seederserver.aws.af.cm/index.php?users&command=login&values[]=" +email +"&hash=" +hash;
			sendRequest(url, function(data){
				 bb.pushScreen('all.html', 'allIdeas');
			});
		});
	}
	function trim(s) {
		return s.replace(/^\s*/, "").replace(/\s*$/, "");
	}
	function validate() {
		if (trim(document.getElementById("email").value) == "") {
			document.getElementById("message").innerHTML = "Login empty";
			document.getElementById("email").focus();
			return false;
		} else if (trim(document.getElementById("password").value) == "") {
			document.getElementById("message").innerHTML = "Password empty";
			document.getElementById("password").focus();
			return false;
		}
		else
			authenticateUser();
	}
	</script> 
	<div data-bb-type="round-panel" width="100%" style="margin: 0 50 0 50;"> 
		<div style="background-image:url('images/seeder.png'); background-repeat: no-repeat; background-position: bottom; height: 300px; margin: 60px 0 80px 0"></div>
			<hr style="width:100%; height:1px; border-color: #8A8A8A; border-bottom: 5px; background-color: #181818"/>
			<div style="margin-bottom:5px;">
				<input id="email" type="text" placeholder="Email"/>
			</div>
			<div style="margin-bottom:30px;">
				<input id="password" type="password" placeholder="Password"/>
			</div>
			<div>
				<div data-bb-type="button" data-bb-style="stretch" style="margin:0 0 5px 0;" onclick="validate()">Login</div>
				<div data-bb-type="button" data-bb-style="stretch" style="margin:0; position: fixed; bottom: 20px; width: 80%" onclick="registerUser()">Register</div>
				<div id = "indicator" data-bb-type="activity-indicator" data-bb-size="small" style="display: none; visibility: hidden;"></div>
				<div id="message" style="color: white"></div>
			</div>
	</div>
</div>